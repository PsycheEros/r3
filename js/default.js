System.register(["./canvas2d", "./canvas3d", "./board", "./rules"], function (exports_1, context_1) {
    "use strict";
    var __moduleName = context_1 && context_1.id;
    function createCanvas(width, height) {
        return document.body.appendChild(Object.assign(document.createElement('canvas'), { width, height }));
    }
    var canvas2d_1, canvas3d_1, board_1, rules_1, width, height, canvas;
    return {
        setters: [
            function (canvas2d_1_1) {
                canvas2d_1 = canvas2d_1_1;
            },
            function (canvas3d_1_1) {
                canvas3d_1 = canvas3d_1_1;
            },
            function (board_1_1) {
                board_1 = board_1_1;
            },
            function (rules_1_1) {
                rules_1 = rules_1_1;
            }
        ],
        execute: function () {
            width = 960, height = 800, canvas = {
                '2d': new canvas2d_1.default(createCanvas(width, height)),
                '3d': new canvas3d_1.default(createCanvas(width, height))
            };
            (() => {
                const board = new board_1.default(8, 8);
                function newGame() {
                    board.reset();
                    board.grid.get({ x: 3, y: 3 }).color = 0;
                    board.grid.get({ x: 4, y: 3 }).color = 1;
                    board.grid.get({ x: 3, y: 4 }).color = 1;
                    board.grid.get({ x: 4, y: 4 }).color = 0;
                }
                newGame();
                const rules = new rules_1.default;
                const { c2d } = canvas['2d'];
                let turn = 0;
                function nextTurn() {
                    if (rules.isGameOver(board.grid, [0, 1])) {
                        return;
                    }
                    turn = (turn + 1) % 2;
                    if (rules.getValidMoves(board.grid, turn).length === 0) {
                        nextTurn();
                    }
                }
                let selectedSquare = null;
                function render(time) {
                    c2d.save();
                    canvas['2d'].clear();
                    c2d.fillStyle = '#6c6';
                    c2d.fillRect(board.bounds.left, board.bounds.top, board.bounds.width, board.bounds.height);
                    c2d.strokeStyle = 'black';
                    for (const { enabled, color, position: { x, y }, bounds: { left, top, width, height, center } } of board) {
                        if (!enabled) {
                            continue;
                        }
                        c2d.save();
                        c2d.lineWidth = 1;
                        c2d.fillStyle = '#8c8';
                        c2d.fillRect(left, top, width, height);
                        c2d.strokeRect(left, top, width, height);
                        if (color !== null) {
                            c2d.lineWidth = 1;
                            c2d.fillStyle = color === 0 ? '#222' : '#ddd';
                            c2d.beginPath();
                            c2d.ellipse(center.x, center.y, width * .4, height * .4, 0, 0, Math.PI * 2);
                            c2d.fill();
                            c2d.stroke();
                        }
                        if (rules.isValid(board.grid, { x, y }, turn)) {
                            c2d.lineWidth = 8;
                            c2d.strokeStyle = turn === 0 ? '#222' : '#ddd';
                            c2d.beginPath();
                            c2d.moveTo(center.x - width * .25, center.y - height * .25);
                            c2d.lineTo(center.x + width * .25, center.y + height * .25);
                            c2d.moveTo(center.x + width * .25, center.y - height * .25);
                            c2d.lineTo(center.x - width * .25, center.y + height * .25);
                            c2d.stroke();
                        }
                        c2d.restore();
                    }
                    const lineHeight = 16, lines = [];
                    if (rules.isGameOver(board.grid, [0, 1])) {
                        lines.push('Game Over');
                    }
                    else {
                        lines.push(`${turn === 0 ? 'Black' : 'White'}'s turn`);
                    }
                    lines.push(`Black: ${rules.getScore(board.grid, 0)}`);
                    lines.push(`White: ${rules.getScore(board.grid, 1)}`);
                    c2d.save();
                    c2d.font = 'bold 16px sans-serif';
                    c2d.textBaseline = 'bottom';
                    c2d.textAlign = 'left';
                    c2d.shadowBlur = 5;
                    c2d.shadowColor = 'white';
                    c2d.fillStyle = 'black';
                    let top = lineHeight;
                    for (const line of lines) {
                        c2d.fillText(line, board.bounds.right, top);
                        top += lineHeight;
                    }
                    c2d.restore();
                    c2d.restore();
                    requestAnimationFrame(render);
                }
                requestAnimationFrame(render);
                function onMouseMove({ clientX, clientY }) {
                    const { x, y } = canvas['2d'].screenToCanvas({ x: clientX, y: clientY });
                    selectedSquare = board.hitTest({ x, y });
                    document.documentElement.style.cursor = selectedSquare && rules.isValid(board.grid, selectedSquare.position, turn) ? 'pointer' : null;
                }
                function onClick({ clientX, clientY }) {
                    if (rules.isGameOver(board.grid, [0, 1])) {
                        newGame();
                        return;
                    }
                    const { x, y } = canvas['2d'].screenToCanvas({ x: clientX, y: clientY }), square = board.hitTest({ x, y });
                    if (square) {
                        if (rules.makeMove(board.grid, square.position, turn)) {
                            nextTurn();
                        }
                    }
                }
                document.addEventListener('mousemove', onMouseMove, false);
                document.addEventListener('click', onClick, false);
                document.addEventListener('touchstart', e => {
                    for (const touch of Array.from(e.touches)) {
                        onClick(touch);
                    }
                }, false);
            })();
        }
    };
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFDLEtBQUssRUFBRSxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBRSxDQUFDO29CQUM3RixHQUFHLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQztvQkFDMUIsR0FBRyxDQUFBLENBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsRUFBRSxJQUFJLEtBQU0sQ0FBQyxDQUFDLENBQUM7d0JBQzNHLEVBQUUsQ0FBQSxDQUFFLENBQUMsT0FBUSxDQUFDLENBQUMsQ0FBQzs0QkFBQyxRQUFRLENBQUM7d0JBQUMsQ0FBQzt3QkFDNUIsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO3dCQUNYLEdBQUcsQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDO3dCQUNsQixHQUFHLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQzt3QkFDdkIsR0FBRyxDQUFDLFFBQVEsQ0FBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUUsQ0FBQzt3QkFDekMsR0FBRyxDQUFDLFVBQVUsQ0FBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUUsQ0FBQzt3QkFFM0MsRUFBRSxDQUFBLENBQUUsS0FBSyxLQUFLLElBQUssQ0FBQyxDQUFDLENBQUM7NEJBQ3JCLEdBQUcsQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDOzRCQUNsQixHQUFHLENBQUMsU0FBUyxHQUFHLEtBQUssS0FBSyxDQUFDLEdBQUcsTUFBTSxHQUFHLE1BQU0sQ0FBQzs0QkFDOUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDOzRCQUNoQixHQUFHLENBQUMsT0FBTyxDQUFFLE1BQU0sQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsRUFBRSxLQUFLLEdBQUcsRUFBRSxFQUFFLE1BQU0sR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFF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QUFjLENBQUUsRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBRSxFQUMzRSxNQUFNLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDO29CQUNwQyxFQUFFLENBQUEsQ0FBRSxNQUFPLENBQUMsQ0FBQyxDQUFDO3dCQUNiLEVBQUUsQ0FBQSxDQUFFLEtBQUssQ0FBQyxRQUFRLENBQUUsS0FBSyxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBRyxDQUFDLENBQUMsQ0FBQzs0QkFDMUQsUUFBUSxFQUFFLENBQUM7d0JBQ1osQ0FBQztvQkFDRixDQUFDO2dCQUNGLENBQUM7Z0JBRUQsUUFBUSxDQUFDLGdCQUFnQixDQUFFLFdBQVcsRUFBRSxXQUFXLEVBQUUsS0FBSyxDQUFFLENBQUM7Z0JBQzdELFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssQ0FBRSxDQUFDO2dCQUNyRCxRQUFRLENBQUMsZ0JBQWdCLENBQUUsWUFBWSxFQUFFLENBQUM7b0JBQ3pDLEdBQUcsQ0FBQSxDQUFFLE1BQU0sS0FBSyxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBRyxDQUFDLENBQUMsQ0FBQzt3QkFDOUMsT0FBTyxDQUFFLEtBQUssQ0FBRSxDQUFDO29CQUNsQixDQUFDO2dCQUNGLENBQUMsRUFBRSxLQUFLLENBQUUsQ0FBQztZQUNaLENBQUMsQ0FBRSxFQUFFLENBQUM7UUFDTixDQUFDIiwiZmlsZSI6ImRlZmF1bHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ2FudmFzMkQgZnJvbSAnLi9jYW52YXMyZCc7XHJcbmltcG9ydCBDYW52YXMzRCBmcm9tICcuL2NhbnZhczNkJztcclxuaW1wb3J0IEJvYXJkIGZyb20gJy4vYm9hcmQnO1xyXG5pbXBvcnQgU3F1YXJlIGZyb20gJy4vc3F1YXJlJztcclxuaW1wb3J0IFJ1bGVzIGZyb20gJy4vcnVsZXMnO1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlQ2FudmFzKCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciApIHtcclxuXHRyZXR1cm4gZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChcclxuXHRcdE9iamVjdC5hc3NpZ24oIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdjYW52YXMnICksIHsgd2lkdGgsIGhlaWdodCB9IClcclxuXHQpIGFzIEhUTUxDYW52YXNFbGVtZW50O1xyXG59XHJcblxyXG5jb25zdCB3aWR0aCA9IDk2MCxcclxuXHRoZWlnaHQgPSA4MDAsXHJcblx0Y2FudmFzID0ge1xyXG5cdFx0JzJkJzogbmV3IENhbnZhczJEKCBjcmVhdGVDYW52YXMoIHdpZHRoLCBoZWlnaHQgKSApLFxyXG5cdFx0JzNkJzogbmV3IENhbnZhczNEKCBjcmVhdGVDYW52YXMoIHdpZHRoLCBoZWlnaHQgKSApXHJcblx0fTtcclxuXHJcbiggKCkgPT4ge1xyXG5cdGNvbnN0IGJvYXJkID0gbmV3IEJvYXJkKCA4LCA4ICk7XHJcblxyXG5cdGZ1bmN0aW9uIG5ld0dhbWUoKSB7XHJcblx0XHRib2FyZC5yZXNldCgpO1xyXG5cdFx0Ym9hcmQuZ3JpZC5nZXQoIHsgeDogMywgeTogMyB9ICkhLmNvbG9yID0gMDtcclxuXHRcdGJvYXJkLmdyaWQuZ2V0KCB7IHg6IDQsIHk6IDMgfSApIS5jb2xvciA9IDE7XHJcblx0XHRib2FyZC5ncmlkLmdldCggeyB4OiAzLCB5OiA0IH0gKSEuY29sb3IgPSAxO1xyXG5cdFx0Ym9hcmQuZ3JpZC5nZXQoIHsgeDogNCwgeTogNCB9ICkhLmNvbG9yID0gMDtcclxuXHR9XHJcblx0bmV3R2FtZSgpO1xyXG5cclxuXHRjb25zdCBydWxlcyA9IG5ldyBSdWxlcztcclxuXHRjb25zdCB7IGMyZCB9ID0gY2FudmFzWyAnMmQnIF07XHJcblx0bGV0IHR1cm4gPSAwO1xyXG5cdGZ1bmN0aW9uIG5leHRUdXJuKCkge1xyXG5cdFx0aWYoIHJ1bGVzLmlzR2FtZU92ZXIoIGJvYXJkLmdyaWQsIFsgMCwgMSBdICkgKSB7IHJldHVybjsgfVxyXG5cdFx0dHVybiA9ICggdHVybiArIDEgKSAlIDI7XHJcblx0XHRpZiggcnVsZXMuZ2V0VmFsaWRNb3ZlcyggYm9hcmQuZ3JpZCwgdHVybiApLmxlbmd0aCA9PT0gMCApIHtcclxuXHRcdFx0bmV4dFR1cm4oKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGxldCBzZWxlY3RlZFNxdWFyZTogU3F1YXJlfG51bGwgPSBudWxsO1xyXG5cdGZ1bmN0aW9uIHJlbmRlciggdGltZTogbnVtYmVyICkge1xyXG5cdFx0YzJkLnNhdmUoKTtcclxuXHRcdGNhbnZhc1sgJzJkJyBdLmNsZWFyKCk7XHJcblxyXG5cdFx0YzJkLmZpbGxTdHlsZSA9ICcjNmM2JztcclxuXHRcdGMyZC5maWxsUmVjdCggYm9hcmQuYm91bmRzLmxlZnQsIGJvYXJkLmJvdW5kcy50b3AsIGJvYXJkLmJvdW5kcy53aWR0aCwgYm9hcmQuYm91bmRzLmhlaWdodCApO1xyXG5cdFx0YzJkLnN0cm9rZVN0eWxlID0gJ2JsYWNrJztcclxuXHRcdGZvciggY29uc3QgeyBlbmFibGVkLCBjb2xvciwgcG9zaXRpb246IHsgeCwgeSB9LCBib3VuZHM6IHsgbGVmdCwgdG9wLCB3aWR0aCwgaGVpZ2h0LCBjZW50ZXIgfSB9IG9mIGJvYXJkICkge1xyXG5cdFx0XHRpZiggIWVuYWJsZWQgKSB7IGNvbnRpbnVlOyB9XHJcblx0XHRcdGMyZC5zYXZlKCk7XHJcblx0XHRcdGMyZC5saW5lV2lkdGggPSAxO1xyXG5cdFx0XHRjMmQuZmlsbFN0eWxlID0gJyM4YzgnO1xyXG5cdFx0XHRjMmQuZmlsbFJlY3QoIGxlZnQsIHRvcCwgd2lkdGgsIGhlaWdodCApO1xyXG5cdFx0XHRjMmQuc3Ryb2tlUmVjdCggbGVmdCwgdG9wLCB3aWR0aCwgaGVpZ2h0ICk7XHJcblxyXG5cdFx0XHRpZiggY29sb3IgIT09IG51bGwgKSB7XHJcblx0XHRcdFx0YzJkLmxpbmVXaWR0aCA9IDE7XHJcblx0XHRcdFx0YzJkLmZpbGxTdHlsZSA9IGNvbG9yID09PSAwID8gJyMyMjInIDogJyNkZGQnO1xyXG5cdFx0XHRcdGMyZC5iZWdpblBhdGgoKTtcclxuXHRcdFx0XHRjMmQuZWxsaXBzZSggY2VudGVyLngsIGNlbnRlci55LCB3aWR0aCAqIC40LCBoZWlnaHQgKiAuNCwgMCwgMCwgTWF0aC5QSSAqIDIgKTtcclxuXHRcdFx0XHRjMmQuZmlsbCgpO1xyXG5cdFx0XHRcdGMyZC5zdHJva2UoKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYoIHJ1bGVzLmlzVmFsaWQoIGJvYXJkLmdyaWQsIHsgeCwgeSB9LCB0dXJuICkgKSB7XHJcblx0XHRcdFx0YzJkLmxpbmVXaWR0aCA9IDg7XHJcblx0XHRcdFx0YzJkLnN0cm9rZVN0eWxlID0gdHVybiA9PT0gMCA/ICcjMjIyJyA6ICcjZGRkJztcclxuXHRcdFx0XHRjMmQuYmVnaW5QYXRoKCk7XHJcblx0XHRcdFx0YzJkLm1vdmVUbyggY2VudGVyLnggLSB3aWR0aCAqIC4yNSwgY2VudGVyLnkgLSBoZWlnaHQgKiAuMjUgKTtcclxuXHRcdFx0XHRjMmQubGluZVRvKCBjZW50ZXIueCArIHdpZHRoICogLjI1LCBjZW50ZXIueSArIGhlaWdodCAqIC4yNSApO1xyXG5cdFx0XHRcdGMyZC5tb3ZlVG8oIGNlbnRlci54ICsgd2lkdGggKiAuMjUsIGNlbnRlci55IC0gaGVpZ2h0ICogLjI1ICk7XHJcblx0XHRcdFx0YzJkLmxpbmVUbyggY2VudGVyLnggLSB3aWR0aCAqIC4yNSwgY2VudGVyLnkgKyBoZWlnaHQgKiAuMjUgKTtcclxuXHRcdFx0XHRjMmQuc3Ryb2tlKCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGMyZC5yZXN0b3JlKCk7XHJcblx0XHR9XHJcblxyXG5cdFx0Y29uc3QgbGluZUhlaWdodCA9IDE2LFxyXG5cdFx0XHRsaW5lcyA9IFtdIGFzIHN0cmluZ1tdO1xyXG5cdFx0aWYoIHJ1bGVzLmlzR2FtZU92ZXIoIGJvYXJkLmdyaWQsIFsgMCwgMSBdICkgKSB7XHJcblx0XHRcdGxpbmVzLnB1c2goICdHYW1lIE92ZXInICk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRsaW5lcy5wdXNoKCBgJHt0dXJuID09PSAwID8gJ0JsYWNrJyA6ICdXaGl0ZSd9J3MgdHVybmAgKTtcclxuXHRcdH1cclxuXHJcblx0XHRsaW5lcy5wdXNoKCBgQmxhY2s6ICR7cnVsZXMuZ2V0U2NvcmUoYm9hcmQuZ3JpZCwwKX1gICk7XHJcblx0XHRsaW5lcy5wdXNoKCBgV2hpdGU6ICR7cnVsZXMuZ2V0U2NvcmUoYm9hcmQuZ3JpZCwxKX1gICk7XHJcblxyXG5cdFx0YzJkLnNhdmUoKTtcclxuXHRcdGMyZC5mb250ID0gJ2JvbGQgMTZweCBzYW5zLXNlcmlmJztcclxuXHRcdGMyZC50ZXh0QmFzZWxpbmUgPSAnYm90dG9tJztcclxuXHRcdGMyZC50ZXh0QWxpZ24gPSAnbGVmdCc7XHJcblx0XHRjMmQuc2hhZG93Qmx1ciA9IDU7XHJcblx0XHRjMmQuc2hhZG93Q29sb3IgPSAnd2hpdGUnO1xyXG5cdFx0YzJkLmZpbGxTdHlsZSA9ICdibGFjayc7XHJcblx0XHRsZXQgdG9wID0gbGluZUhlaWdodDtcclxuXHRcdGZvciggY29uc3QgbGluZSBvZiBsaW5lcyApIHtcclxuXHRcdFx0YzJkLmZpbGxUZXh0KCBsaW5lLCBib2FyZC5ib3VuZHMucmlnaHQsIHRvcCApO1xyXG5cdFx0XHR0b3AgKz0gbGluZUhlaWdodDtcclxuXHRcdH1cclxuXHRcdGMyZC5yZXN0b3JlKCk7XHJcblxyXG5cdFx0YzJkLnJlc3RvcmUoKTtcclxuXHRcdHJlcXVlc3RBbmltYXRpb25GcmFtZSggcmVuZGVyICk7XHJcblx0fVxyXG5cdHJlcXVlc3RBbmltYXRpb25GcmFtZSggcmVuZGVyICk7XHJcblxyXG5cdGZ1bmN0aW9uIG9uTW91c2VNb3ZlKCB7IGNsaWVudFgsIGNsaWVudFkgfTogeyBjbGllbnRYOiBudW1iZXIsIGNsaWVudFk6IG51bWJlciB9ICkge1xyXG5cdFx0Y29uc3QgeyB4LCB5IH0gPSBjYW52YXNbICcyZCcgXS5zY3JlZW5Ub0NhbnZhcyggeyB4OiBjbGllbnRYLCB5OiBjbGllbnRZIH0gKTtcclxuXHRcdHNlbGVjdGVkU3F1YXJlID0gYm9hcmQuaGl0VGVzdCggeyB4LCB5IH0gKTtcclxuXHRcdGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5jdXJzb3IgPSBzZWxlY3RlZFNxdWFyZSAmJiBydWxlcy5pc1ZhbGlkKCBib2FyZC5ncmlkLCBzZWxlY3RlZFNxdWFyZS5wb3NpdGlvbiwgdHVybiApID8gJ3BvaW50ZXInIDogbnVsbDtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIG9uQ2xpY2soIHsgY2xpZW50WCwgY2xpZW50WSB9OiB7IGNsaWVudFg6IG51bWJlciwgY2xpZW50WTogbnVtYmVyIH0gKSB7XHJcblx0XHRpZiggcnVsZXMuaXNHYW1lT3ZlciggYm9hcmQuZ3JpZCwgWyAwLCAxIF0gKSApIHtcclxuXHRcdFx0bmV3R2FtZSgpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0Y29uc3QgeyB4LCB5IH0gPSBjYW52YXNbICcyZCcgXS5zY3JlZW5Ub0NhbnZhcyggeyB4OiBjbGllbnRYLCB5OiBjbGllbnRZIH0gKSxcclxuXHRcdFx0c3F1YXJlID0gYm9hcmQuaGl0VGVzdCggeyB4LCB5IH0gKTtcclxuXHRcdGlmKCBzcXVhcmUgKSB7XHJcblx0XHRcdGlmKCBydWxlcy5tYWtlTW92ZSggYm9hcmQuZ3JpZCwgc3F1YXJlLnBvc2l0aW9uLCB0dXJuICkgKSB7XHJcblx0XHRcdFx0bmV4dFR1cm4oKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ21vdXNlbW92ZScsIG9uTW91c2VNb3ZlLCBmYWxzZSApO1xyXG5cdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdjbGljaycsIG9uQ2xpY2ssIGZhbHNlICk7XHJcblx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ3RvdWNoc3RhcnQnLCBlID0+IHtcclxuXHRcdGZvciggY29uc3QgdG91Y2ggb2YgQXJyYXkuZnJvbSggZS50b3VjaGVzICkgKSB7XHJcblx0XHRcdG9uQ2xpY2soIHRvdWNoICk7XHJcblx0XHR9XHJcblx0fSwgZmFsc2UgKTtcclxufSApKCk7XHJcbiJdfQ==
