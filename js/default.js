System.register(["./canvas2d", "./canvas3d", "./board", "./rules"], function (exports_1, context_1) {
    "use strict";
    var __moduleName = context_1 && context_1.id;
    function createCanvas(width, height) {
        return document.querySelector('body').appendChild(Object.assign(document.createElement('canvas'), { width, height }));
    }
    var canvas2d_1, canvas3d_1, board_1, rules_1, body, width, height, canvas;
    return {
        setters: [
            function (canvas2d_1_1) {
                canvas2d_1 = canvas2d_1_1;
            },
            function (canvas3d_1_1) {
                canvas3d_1 = canvas3d_1_1;
            },
            function (board_1_1) {
                board_1 = board_1_1;
            },
            function (rules_1_1) {
                rules_1 = rules_1_1;
            }
        ],
        execute: function () {
            body = document.querySelector('body'), width = 960, height = 800, canvas = {
                '2d': new canvas2d_1.default(createCanvas(width, height)),
                '3d': new canvas3d_1.default(createCanvas(width, height))
            };
            (() => {
                const board = new board_1.default(8, 8);
                function newGame() {
                    board.reset();
                    board.grid.get({ x: 3, y: 3 }).color = 0;
                    board.grid.get({ x: 4, y: 3 }).color = 1;
                    board.grid.get({ x: 3, y: 4 }).color = 1;
                    board.grid.get({ x: 4, y: 4 }).color = 0;
                }
                newGame();
                const rules = new rules_1.default;
                const { c2d } = canvas['2d'];
                let turn = 0;
                function nextTurn() {
                    if (rules.isGameOver(board.grid, [0, 1]))
                        return;
                    turn = (turn + 1) % 2;
                    if (rules.getValidMoves(board.grid, turn).length === 0) {
                        nextTurn();
                    }
                }
                let selectedSquare = null;
                function render(time) {
                    c2d.save();
                    c2d.strokeStyle = 'black';
                    canvas['2d'].clear();
                    for (const { enabled, color, position: { x, y }, bounds: { left, top, width, height, center } } of board) {
                        if (!enabled)
                            continue;
                        c2d.save();
                        c2d.lineWidth = 1;
                        c2d.fillStyle = (x + y) % 2 === 0 ? '#000' : '#fff';
                        c2d.fillRect(left, top, width, height);
                        c2d.strokeRect(left, top, width, height);
                        if (color !== null) {
                            c2d.lineWidth = 1;
                            c2d.fillStyle = color === 0 ? '#222' : '#ddd';
                            c2d.beginPath();
                            c2d.ellipse(center.x, center.y, width * .4, height * .4, 0, 0, Math.PI * 2);
                            c2d.fill();
                            c2d.stroke();
                        }
                        if (rules.isValid(board.grid, { x, y }, turn)) {
                            c2d.lineWidth = 8;
                            c2d.strokeStyle = turn === 0 ? '#222' : '#ddd';
                            c2d.beginPath();
                            c2d.moveTo(center.x - width * .25, center.y - height * .25);
                            c2d.lineTo(center.x + width * .25, center.y + height * .25);
                            c2d.moveTo(center.x + width * .25, center.y - height * .25);
                            c2d.lineTo(center.x - width * .25, center.y + height * .25);
                            c2d.stroke();
                        }
                        c2d.restore();
                    }
                    const lineHeight = 16, lines = [];
                    if (rules.isGameOver(board.grid, [0, 1])) {
                        lines.push('Game Over');
                    }
                    else {
                        lines.push(`${turn === 0 ? 'Black' : 'White'}'s turn`);
                    }
                    lines.push(`Black: ${rules.getScore(board.grid, 0)}`);
                    lines.push(`White: ${rules.getScore(board.grid, 1)}`);
                    c2d.save();
                    c2d.font = 'bold 16px sans-serif';
                    c2d.textBaseline = 'bottom';
                    c2d.textAlign = 'left';
                    c2d.shadowBlur = 5;
                    c2d.shadowColor = 'white';
                    c2d.fillStyle = 'black';
                    let top = lineHeight;
                    for (const line of lines) {
                        c2d.fillText(line, board.bounds.right, top);
                        top += lineHeight;
                    }
                    c2d.restore();
                    c2d.restore();
                    requestAnimationFrame(render);
                }
                requestAnimationFrame(render);
                document.addEventListener('mousemove', ({ clientX, clientY }) => {
                    const { x, y } = canvas['2d'].screenToCanvas({ x: clientX, y: clientY });
                    selectedSquare = board.hitTest({ x, y });
                    document.documentElement.style.cursor = selectedSquare && rules.isValid(board.grid, selectedSquare.position, turn) ? 'pointer' : null;
                }, false);
                document.addEventListener('click', ({ clientX, clientY }) => {
                    if (rules.isGameOver(board.grid, [0, 1])) {
                        newGame();
                        return;
                    }
                    const { x, y } = canvas['2d'].screenToCanvas({ x: clientX, y: clientY }), square = board.hitTest({ x, y });
                    if (square) {
                        if (rules.makeMove(board.grid, square.position, turn))
                            nextTurn();
                    }
                }, false);
            })();
        }
    };
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3RzL2RlZmF1bHQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0lBTUEsc0JBQXVCLEtBQWEsRUFBRSxNQUFjO1FBQ25ELE1BQU0sQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFFLE1BQU0sQ0FBRyxDQUFDLFdBQVcsQ0FDbkQsTUFBTSxDQUFDLE1BQU0sQ0FBRSxRQUFRLENBQUMsYUFBYSxDQUFFLFFBQVEsQ0FBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxDQUFFLENBQ2pELENBQUM7SUFDeEIsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7O1lBRUssSUFBSSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUUsTUFBTSxDQUFFLEVBQzVDLEtBQUssR0FBRyxHQUFHLEVBQ1gsTUFBTSxHQUFHLEdBQUcsRUFDWixNQUFNLEdBQUc7Z0JBQ1IsSUFBSSxFQUFFLElBQUksa0JBQVEsQ0FBRSxZQUFZLENBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBRSxDQUFFO2dCQUNuRCxJQUFJLEVBQUUsSUFBSSxrQkFBUSxDQUFFLFlBQVksQ0FBRSxLQUFLLEVBQUUsTUFBTSxDQUFFLENBQUU7YUFDbkQsQ0FBQztZQUVILENBQUU7Z0JBQ0QsTUFBTSxLQUFLLEdBQUcsSUFBSSxlQUFLLENBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBRSxDQUFDO2dCQUVoQztvQkFDQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7b0JBQ2QsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBRyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7b0JBQzVDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUcsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO29CQUM1QyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFHLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztvQkFDNUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBRyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7Z0JBQzdDLENBQUM7Z0JBQ0QsT0FBTyxFQUFFLENBQUM7Z0JBRVYsTUFBTSxLQUFLLEdBQUcsSUFBSSxlQUFLLENBQUM7Z0JBQ3hCLE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRyxNQUFNLENBQUUsSUFBSSxDQUFFLENBQUM7Z0JBQy9CLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQztnQkFDYjtvQkFDQyxFQUFFLENBQUEsQ0FBRSxLQUFLLENBQUMsVUFBVSxDQUFFLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxDQUFFLENBQUcsQ0FBQzt3QkFBQyxNQUFNLENBQUM7b0JBQ3RELElBQUksR0FBRyxDQUFFLElBQUksR0FBRyxDQUFDLENBQUUsR0FBRyxDQUFDLENBQUM7b0JBQ3hCLEVBQUUsQ0FBQSxDQUFFLEtBQUssQ0FBQyxhQUFhLENBQUUsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUUsQ0FBQyxNQUFNLEtBQUssQ0FBRSxDQUFDLENBQUMsQ0FBQzt3QkFDM0QsUUFBUSxFQUFFLENBQUM7b0JBQ1osQ0FBQztnQkFDRixDQUFDO2dCQUVELElBQUksY0FBYyxHQUFnQixJQUFJLENBQUM7Z0JBQ3ZDLGdCQUFpQixJQUFZO29CQUM1QixHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7b0JBRVgsR0FBRyxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUM7b0JBQzFCLE1BQU0sQ0FBRSxJQUFJLENBQUUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztvQkFDdkIsR0FBRyxDQUFBLENBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsRUFBRSxJQUFJLEtBQU0sQ0FBQyxDQUFDLENBQUM7d0JBQzNHLEVBQUUsQ0FBQSxDQUFFLENBQUMsT0FBUSxDQUFDOzRCQUFDLFFBQVEsQ0FBQzt3QkFDeEIsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO3dCQUNYLEdBQUcsQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDO3dCQUNsQixHQUFHLENBQUMsU0FBUyxHQUFHLENBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBRSxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsTUFBTSxHQUFHLE1BQU0sQ0FBQzt3QkFDdEQsR0FBRyxDQUFDLFFBQVEsQ0FBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUUsQ0FBQzt3QkFDekMsR0FBRyxDQUFDLFVBQVUsQ0FBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUUsQ0FBQzt3QkFFM0MsRUFBRSxDQUFBLENBQUUsS0FBSyxLQUFLLElBQUssQ0FBQyxDQUFDLENBQUM7NEJBQ3JCLEdBQUcsQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDOzRCQUNsQixHQUFHLENBQUMsU0FBUyxHQUFHLEtBQUssS0FBSyxDQUFDLEdBQUcsTUFBTSxHQUFHLE1BQU0sQ0FBQzs0QkFDOUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDOzRCQUNoQixHQUFHLENBQUMsT0FBTyxDQUFFLE1BQU0sQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsRUFBRSxLQUFLLEdBQUcsRUFBRSxFQUFFLE1BQU0sR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBRSxDQUFDOzRCQUM5RSxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7NEJBQ1gsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDO3dC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LENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBRSxFQUMzRSxNQUFNLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDO29CQUNwQyxFQUFFLENBQUEsQ0FBRSxNQUFPLENBQUMsQ0FBQyxDQUFDO3dCQUNiLEVBQUUsQ0FBQSxDQUFFLEtBQUssQ0FBQyxRQUFRLENBQUUsS0FBSyxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBRyxDQUFDOzRCQUFDLFFBQVEsRUFBRSxDQUFDO29CQUN0RSxDQUFDO2dCQUNGLENBQUMsRUFBRSxLQUFLLENBQUUsQ0FBQztZQUNaLENBQUMsQ0FBRSxFQUFFLENBQUM7UUFDTixDQUFDIiwiZmlsZSI6ImRlZmF1bHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ2FudmFzMkQgZnJvbSAnLi9jYW52YXMyZCc7XHJcbmltcG9ydCBDYW52YXMzRCBmcm9tICcuL2NhbnZhczNkJztcclxuaW1wb3J0IEJvYXJkIGZyb20gJy4vYm9hcmQnO1xyXG5pbXBvcnQgU3F1YXJlIGZyb20gJy4vc3F1YXJlJztcclxuaW1wb3J0IFJ1bGVzIGZyb20gJy4vcnVsZXMnO1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlQ2FudmFzKCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciApIHtcclxuXHRyZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvciggJ2JvZHknICkhLmFwcGVuZENoaWxkKFxyXG5cdFx0T2JqZWN0LmFzc2lnbiggZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2NhbnZhcycgKSwgeyB3aWR0aCwgaGVpZ2h0IH0gKVxyXG5cdCkgYXMgSFRNTENhbnZhc0VsZW1lbnQ7XHJcbn1cclxuXHJcbmNvbnN0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCAnYm9keScgKSxcclxuXHR3aWR0aCA9IDk2MCxcclxuXHRoZWlnaHQgPSA4MDAsXHJcblx0Y2FudmFzID0ge1xyXG5cdFx0JzJkJzogbmV3IENhbnZhczJEKCBjcmVhdGVDYW52YXMoIHdpZHRoLCBoZWlnaHQgKSApLFxyXG5cdFx0JzNkJzogbmV3IENhbnZhczNEKCBjcmVhdGVDYW52YXMoIHdpZHRoLCBoZWlnaHQgKSApXHJcblx0fTtcclxuXHJcbiggKCkgPT4ge1xyXG5cdGNvbnN0IGJvYXJkID0gbmV3IEJvYXJkKCA4LCA4ICk7XHJcblxyXG5cdGZ1bmN0aW9uIG5ld0dhbWUoKSB7XHJcblx0XHRib2FyZC5yZXNldCgpO1xyXG5cdFx0Ym9hcmQuZ3JpZC5nZXQoIHsgeDogMywgeTogMyB9ICkhLmNvbG9yID0gMDtcclxuXHRcdGJvYXJkLmdyaWQuZ2V0KCB7IHg6IDQsIHk6IDMgfSApIS5jb2xvciA9IDE7XHJcblx0XHRib2FyZC5ncmlkLmdldCggeyB4OiAzLCB5OiA0IH0gKSEuY29sb3IgPSAxO1xyXG5cdFx0Ym9hcmQuZ3JpZC5nZXQoIHsgeDogNCwgeTogNCB9ICkhLmNvbG9yID0gMDtcclxuXHR9XHJcblx0bmV3R2FtZSgpO1xyXG5cclxuXHRjb25zdCBydWxlcyA9IG5ldyBSdWxlcztcclxuXHRjb25zdCB7IGMyZCB9ID0gY2FudmFzWyAnMmQnIF07XHJcblx0bGV0IHR1cm4gPSAwO1xyXG5cdGZ1bmN0aW9uIG5leHRUdXJuKCkge1xyXG5cdFx0aWYoIHJ1bGVzLmlzR2FtZU92ZXIoIGJvYXJkLmdyaWQsIFsgMCwgMSBdICkgKSByZXR1cm47XHJcblx0XHR0dXJuID0gKCB0dXJuICsgMSApICUgMjtcclxuXHRcdGlmKCBydWxlcy5nZXRWYWxpZE1vdmVzKCBib2FyZC5ncmlkLCB0dXJuICkubGVuZ3RoID09PSAwICkge1xyXG5cdFx0XHRuZXh0VHVybigpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0bGV0IHNlbGVjdGVkU3F1YXJlOiBTcXVhcmV8bnVsbCA9IG51bGw7XHJcblx0ZnVuY3Rpb24gcmVuZGVyKCB0aW1lOiBudW1iZXIgKSB7XHJcblx0XHRjMmQuc2F2ZSgpO1xyXG5cclxuXHRcdGMyZC5zdHJva2VTdHlsZSA9ICdibGFjayc7XHJcblx0XHRjYW52YXNbICcyZCcgXS5jbGVhcigpO1xyXG5cdFx0Zm9yKCBjb25zdCB7IGVuYWJsZWQsIGNvbG9yLCBwb3NpdGlvbjogeyB4LCB5IH0sIGJvdW5kczogeyBsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQsIGNlbnRlciB9IH0gb2YgYm9hcmQgKSB7XHJcblx0XHRcdGlmKCAhZW5hYmxlZCApIGNvbnRpbnVlO1xyXG5cdFx0XHRjMmQuc2F2ZSgpO1xyXG5cdFx0XHRjMmQubGluZVdpZHRoID0gMTtcclxuXHRcdFx0YzJkLmZpbGxTdHlsZSA9ICggeCArIHkgKSAlIDIgPT09IDAgPyAnIzAwMCcgOiAnI2ZmZic7XHJcblx0XHRcdGMyZC5maWxsUmVjdCggbGVmdCwgdG9wLCB3aWR0aCwgaGVpZ2h0ICk7XHJcblx0XHRcdGMyZC5zdHJva2VSZWN0KCBsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQgKTtcclxuXHJcblx0XHRcdGlmKCBjb2xvciAhPT0gbnVsbCApIHtcclxuXHRcdFx0XHRjMmQubGluZVdpZHRoID0gMTtcclxuXHRcdFx0XHRjMmQuZmlsbFN0eWxlID0gY29sb3IgPT09IDAgPyAnIzIyMicgOiAnI2RkZCc7XHJcblx0XHRcdFx0YzJkLmJlZ2luUGF0aCgpO1xyXG5cdFx0XHRcdGMyZC5lbGxpcHNlKCBjZW50ZXIueCwgY2VudGVyLnksIHdpZHRoICogLjQsIGhlaWdodCAqIC40LCAwLCAwLCBNYXRoLlBJICogMiApO1xyXG5cdFx0XHRcdGMyZC5maWxsKCk7XHJcblx0XHRcdFx0YzJkLnN0cm9rZSgpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiggcnVsZXMuaXNWYWxpZCggYm9hcmQuZ3JpZCwgeyB4LCB5IH0sIHR1cm4gKSApIHtcclxuXHRcdFx0XHRjMmQubGluZVdpZHRoID0gODtcclxuXHRcdFx0XHRjMmQuc3Ryb2tlU3R5bGUgPSB0dXJuID09PSAwID8gJyMyMjInIDogJyNkZGQnO1xyXG5cdFx0XHRcdGMyZC5iZWdpblBhdGgoKTtcclxuXHRcdFx0XHRjMmQubW92ZVRvKCBjZW50ZXIueCAtIHdpZHRoICogLjI1LCBjZW50ZXIueSAtIGhlaWdodCAqIC4yNSApO1xyXG5cdFx0XHRcdGMyZC5saW5lVG8oIGNlbnRlci54ICsgd2lkdGggKiAuMjUsIGNlbnRlci55ICsgaGVpZ2h0ICogLjI1ICk7XHJcblx0XHRcdFx0YzJkLm1vdmVUbyggY2VudGVyLnggKyB3aWR0aCAqIC4yNSwgY2VudGVyLnkgLSBoZWlnaHQgKiAuMjUgKTtcclxuXHRcdFx0XHRjMmQubGluZVRvKCBjZW50ZXIueCAtIHdpZHRoICogLjI1LCBjZW50ZXIueSArIGhlaWdodCAqIC4yNSApO1xyXG5cdFx0XHRcdGMyZC5zdHJva2UoKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0YzJkLnJlc3RvcmUoKTtcclxuXHRcdH1cclxuXHJcblx0XHRjb25zdCBsaW5lSGVpZ2h0ID0gMTYsXHJcblx0XHRcdGxpbmVzID0gW10gYXMgc3RyaW5nW107XHJcblx0XHRpZiggcnVsZXMuaXNHYW1lT3ZlciggYm9hcmQuZ3JpZCwgWyAwLCAxIF0gKSApIHtcclxuXHRcdFx0bGluZXMucHVzaCggJ0dhbWUgT3ZlcicgKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGxpbmVzLnB1c2goIGAke3R1cm4gPT09IDAgPyAnQmxhY2snIDogJ1doaXRlJ30ncyB0dXJuYCApO1xyXG5cdFx0fVxyXG5cclxuXHRcdGxpbmVzLnB1c2goIGBCbGFjazogJHtydWxlcy5nZXRTY29yZShib2FyZC5ncmlkLDApfWAgKTtcclxuXHRcdGxpbmVzLnB1c2goIGBXaGl0ZTogJHtydWxlcy5nZXRTY29yZShib2FyZC5ncmlkLDEpfWAgKTtcclxuXHJcblx0XHRjMmQuc2F2ZSgpO1xyXG5cdFx0YzJkLmZvbnQgPSAnYm9sZCAxNnB4IHNhbnMtc2VyaWYnO1xyXG5cdFx0YzJkLnRleHRCYXNlbGluZSA9ICdib3R0b20nO1xyXG5cdFx0YzJkLnRleHRBbGlnbiA9ICdsZWZ0JztcclxuXHRcdGMyZC5zaGFkb3dCbHVyID0gNTtcclxuXHRcdGMyZC5zaGFkb3dDb2xvciA9ICd3aGl0ZSc7XHJcblx0XHRjMmQuZmlsbFN0eWxlID0gJ2JsYWNrJztcclxuXHRcdGxldCB0b3AgPSBsaW5lSGVpZ2h0O1xyXG5cdFx0Zm9yKCBjb25zdCBsaW5lIG9mIGxpbmVzICkge1xyXG5cdFx0XHRjMmQuZmlsbFRleHQoIGxpbmUsIGJvYXJkLmJvdW5kcy5yaWdodCwgdG9wICk7XHJcblx0XHRcdHRvcCArPSBsaW5lSGVpZ2h0O1xyXG5cdFx0fVxyXG5cdFx0YzJkLnJlc3RvcmUoKTtcclxuXHJcblx0XHRjMmQucmVzdG9yZSgpO1xyXG5cdFx0cmVxdWVzdEFuaW1hdGlvbkZyYW1lKCByZW5kZXIgKTtcclxuXHR9XHJcblx0cmVxdWVzdEFuaW1hdGlvbkZyYW1lKCByZW5kZXIgKTtcclxuXHJcblx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ21vdXNlbW92ZScsICggeyBjbGllbnRYLCBjbGllbnRZIH0gKSA9PiB7XHJcblx0XHRjb25zdCB7IHgsIHkgfSA9IGNhbnZhc1sgJzJkJyBdLnNjcmVlblRvQ2FudmFzKCB7IHg6IGNsaWVudFgsIHk6IGNsaWVudFkgfSApO1xyXG5cdFx0c2VsZWN0ZWRTcXVhcmUgPSBib2FyZC5oaXRUZXN0KCB7IHgsIHkgfSApO1xyXG5cdFx0ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLmN1cnNvciA9IHNlbGVjdGVkU3F1YXJlICYmIHJ1bGVzLmlzVmFsaWQoIGJvYXJkLmdyaWQsIHNlbGVjdGVkU3F1YXJlLnBvc2l0aW9uLCB0dXJuICkgPyAncG9pbnRlcicgOiBudWxsO1xyXG5cdH0sIGZhbHNlICk7XHJcblxyXG5cdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdjbGljaycsICggeyBjbGllbnRYLCBjbGllbnRZIH0gKSA9PiB7XHJcblx0XHRpZiggcnVsZXMuaXNHYW1lT3ZlciggYm9hcmQuZ3JpZCwgWyAwLCAxIF0gKSApIHtcclxuXHRcdFx0bmV3R2FtZSgpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0Y29uc3QgeyB4LCB5IH0gPSBjYW52YXNbICcyZCcgXS5zY3JlZW5Ub0NhbnZhcyggeyB4OiBjbGllbnRYLCB5OiBjbGllbnRZIH0gKSxcclxuXHRcdFx0c3F1YXJlID0gYm9hcmQuaGl0VGVzdCggeyB4LCB5IH0gKTtcclxuXHRcdGlmKCBzcXVhcmUgKSB7XHJcblx0XHRcdGlmKCBydWxlcy5tYWtlTW92ZSggYm9hcmQuZ3JpZCwgc3F1YXJlLnBvc2l0aW9uLCB0dXJuICkgKSBuZXh0VHVybigpO1xyXG5cdFx0fVxyXG5cdH0sIGZhbHNlICk7XHJcbn0gKSgpO1xyXG4iXX0=
